---
import Button from "../components/starwind/button/index";
import Input from "../components/starwind/input/index";
import Layout from "@/layouts/Layout.astro";
---

<Layout>
  <div class="min-h-screen flex items-center justify-center px-4">
    <div class="h-full w-full max-w-md space-y-4">
      <p class="text-3xl capitalize">login</p>

      <div class="space-y-2 w-full">
        <Input
          class="placeholder:capitalize"
          type="email"
          id="email"
          placeholder="email"
        />
        <Input
          class="placeholder:capitalize"
          type="password"
          id="password"
          placeholder="password"
        />

        <div id="error-message" class="text-red-500 text-sm hidden" />

        <Button id="login-btn" class="w-full bg-stone-800 capitalize"
          >login</Button
        >
      </div>

      <p class="text-stone-700">
        Don't have an account yet? <a
          href="/signup"
          class="underline text-black capitalize">sign up</a
        >
      </p>
    </div>
  </div>

    <script>

        const errorDiv = document.getElementById("error-message");

        function showError(message: string) {

            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.remove("hidden");
            };

        };
        
        import { actions } from "astro:actions";

        const loginBtn = document.getElementById("login-btn");

            loginBtn?.addEventListener("click", async () => {
                
            const email = (document.getElementById("email") as any).value;
            const password = (document.getElementById("password") as any).value;

            try {

                const { data, error: actionError } = await actions.login({ email, password });

                if (data?.error || actionError) {
                    showError(data?.error || "An unexpected error occurred");
                    return ;
                };

                window.location.href = "/";

            } catch (err) {

                showError("An unexpected error occurred");
                console.error(err);

            };

        });

    </script>
</Layout>

<style>
    
    input:-webkit-autofill,
    input:-webkit-autofill:hover, 
    input:-webkit-autofill:focus, 
    input:-webkit-autofill:active{
        -webkit-box-shadow: 0 0 0 30px white inset !important;
    }
    
</style>